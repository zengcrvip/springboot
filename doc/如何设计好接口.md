# 如何设计好接口
## 前言

随着业务的发展，系统架构从单体架构变为面向服务架构，水平分层架构；再变为微服务架构，服务网格，服务与服务间
的交互通过rpc协议交互。如何优雅的设计一个接口，需要考虑哪些方面？特别是对公服务（比如BFF）需要对外提供公网域名的接口，安全性
怎么保证，本文整理了一些常见的措施以及具体如何去实现
 
 
## 常见措施
### 防御性编程
### 数据有效性校验
### 幂等设计
 
数据发生改变才需要做幂等，查询接口是天然幂等的<br>
**请求层面：** 多次执行的结果是一致的<br>
**业务层面：** 同一个用户不重复下单，商品不超卖，MQ不重复消费

幂等的本质：分布式锁的问题<br>
分布式环境下，锁定全局唯一资源，使请求串行化，实际表现为互斥锁，防止重复，解决幂等,
分布式锁正常可以通过redis或zookeeper实现，
 
### 安全性
1. 数据加密

我们知道数据在传输过程中是很容易被抓包的，如果直接传输比如http协议传输，那么数据在传输的过程中可能被任何人获取。所以必须对数据进行
加密，常见的做法是对敏感数据比如身份证号进行md5加密。现在主流的做法是使用https协议，在http和tcp之间添加一层数数据安全层(SSL层)，
这一层负责数据的加密和解密。https如何配置和使用，读者可以自行去研究。<br>
**对称加密:** 密钥在加密过程中和解密过程中是不变的，常见的算法有DES,AES;优点是加解密计算速度快；缺点是数据传送前，服务双方必须约定
好密钥，如果一方密钥泄露，加密信息也就不安全了。<br>
**非对称加密:** 密钥成对出现，一个密钥加密之后，由另外一个密钥来解密；私钥放在服务端文件中，公钥可以发布给任何人使用；优点是比对称
加密更安全，但是加解密的速度比对称加密慢多了，广泛使用的是RSA算法；https的实现正好是结合了两种加密方式，整合了双方的优点，在安全性和
性能方面都比较好。<br>
对称加密和非对称加密的代码实现，jdk提供了相关的工具类可以直接使用，本文不过多介绍。<br>

2. 数据签名

介绍3种数据签名安全策略：**摘要[KEY]** , **签名[证书]** , **签名+加密[证书]** <br>
![](doc/如何设计好接口.resources/安全策略级别.png)




3. 时间戳机制
4. AppId机制
5. 黑名单机制

### 限流机制

### 服务降级
